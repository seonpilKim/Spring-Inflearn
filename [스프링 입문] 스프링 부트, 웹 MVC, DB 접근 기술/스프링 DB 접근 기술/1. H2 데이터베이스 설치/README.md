# 스프링 DB 접근 기술
- **스프링 데이터 접근**
    1. **H2 데이터베이스 설치**
    2. 순수 Jdbc
    3. 스프링 통합 테스트
    4. 스프링 JdbcTemplate
    5. JPA
    6. 스프링 데이터 JPA

## H2 데이터베이스 설치
- 개발이나 테스트 용도로 가볍고 편리한 DB, 웹 화면 제공
- https://www.h2database.com
- 다운로드 및 설치
- h2 데이터베이스 버전은 스프링 부트 버전에 맞춘다.
- 권한 주기 : `chmod 755 h2.sh` (Windows 사용자는 x)
- 실행 : `./h2.sh` (Windows 사용자는 `h2.bat`)
- 데이터 베이스 파일 생성 방법
    - `jdbc:h2:~/test` (최초 한 번)
    - `~/ksp97/test.mv.db`파일 생성 확인
    - 이후부터는 `jdbc:h2:tcp://localhost/~/test` 이렇게 접속

### 테이블 생성하기
- 테이블 관리를 위해 프로젝트 루트에 `sql/ddl.sql` 파일을 생성
    ```sql
    drop table if exists member CASCADE;
    create table member(
        id bigint generated by default as identity,
        name varchar(255),
        primary key (id)
    );
    ```
- H2 데이터베이스에 접근해서 `member` 테이블 생성

### H2 데이터베이스가 정상 생성되지 않을 때
- 다음과 같은 오류 메세지가 나오며 H2 데이터베이스가 정상 생성되지 않는 경우가 있다.
    > Database "/Users/ksp97/test" not found, either pre-create it or allow remote database creation (not recommended in secure environments) [90149-200] 90149/90149
- 해결 방안은 다음과 같다.
    1. H2 데이터베이스를 종료하고, 다시 시작한다.
    2. 웹 브라우저가 자동 실행되면, 주소창에 다음과 같이 되어있다.
        > xxx.x.x.x:8082/login.jsp?jsessionid=xxxxxxxxxxxxxxxxxxx
    3. 다음과 같이 앞 부분만 `xxx.x.x.x` -> `localhost`로 변경하고 Enter를 입력한다.
        - 나머지 부분은 절대 변경하면 안된다. (특히 뒤의 세션 부분이 변경되면 안된다.)
        > localhost:8082/login.jsp?jsessionid=xxxxxxxxxxxxxxxxxxx
    4. 데이터베이스 파일을 생성하면 (`jdbc:h2~/test`), 데이터베이스가 정상 생성된다.
